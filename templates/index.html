<!DOCTYPE html>
<html lang="en">
<!-- Base HTML File written by Enes Berk Sakalli-->

<head>

  <head>
    <!-- Sets the character encoding for the document to UTF-8 -->
    <meta charset="utf-8" />

    <!-- The title of the document that appears in the title bar or tab of the browser -->
    <title>Phylo-Cello-Cartography</title>

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="A brief description of your page." />
    <link rel="icon" href="favicon.ico" />

    <!-- Link to the external CSS file to style the document -->
    <link rel="stylesheet" href="../static/css/style.css" />

    <!-- Link to the D3.js library, which is a JavaScript library for creating dynamic and interactive data visualizations -->
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <!-- Link to the UIkit CSS library for styling and layout -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.15.22/dist/css/uikit.min.css" />

    <!-- Link to the UIkit JavaScript library for interactive elements -->
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.15.22/dist/js/uikit.min.js"></script>
    <!-- Link to the UIkit Icon library to enable use of various icons in the UI -->
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.15.22/dist/js/uikit-icons.min.js"></script>

    <link href="https://unpkg.com/tabulator-tables@5.5.0/dist/css/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@5.5.0/dist/js/tabulator.min.js"></script>

  </head>
</head>

<body>
  <div class="container">
    <!-- beginning of menu -->
    <div class="uk-card uk-card-default uk-card-body uk-width-1-6@s">
      <ul class="uk-nav-default" uk-nav>
        <li class="uk-nav-header">Phylo-Cello-Cartography</li>
        <li id="button-row"></li>
        <li>
          <a id="modal-tree-dimension-button">
            <span class="uk-margin-small-right" uk-icon="icon: graph"></span>Graph
          </a>
        </li>
        <li>
          <a href="#" id="save-tree-button"><span class="uk-margin-small-right" uk-icon="icon: camera"></span>Save</a>
        </li>
        <li>
          <a id="data-value-plot-button"><span class="uk-margin-small-right" uk-icon="icon: world"></span>FullData</a>
        </li>
      </ul>

      <ul id="branch-values-vector" class="uk-nav uk-nav-sub">
        <li class="uk-nav-header"><span class="uk-margin-small-right" uk-icon="icon: nut"></span>
          Branch Values
        </li>
      </ul>

      <ul id="select-mode-container" class="uk-nav uk-nav-sub">
        <li class="uk-nav-header"><span class="uk-margin-small-right" uk-icon="icon: file-text"></span>
          MSA-Modus
          <select id="mode-selector" class="uk-select" aria-label="Select">
            <option value="phylo-msa">Model-Phylo-MSA</option>
            <option value="classical-phylo">Mode-Classical-Phylo</option>
          </select>
        </li>
      </ul>
      <ul id="select-color-mode-container" class="uk-nav uk-nav-sub">
        <li class="uk-nav-header"><span class="uk-margin-small-right" uk-icon="icon: file-text"></span>
          Color-Mode
          <select id="color-mode-selector" class="uk-select" aria-label="Select">
            <option value="regular">Regular</option>
            <option value="plasma">Plasma</option>
          </select>
        </li>
      </ul>
      <ul class="uk-nav uk-nav-sub">
        <li>
          <div>
            <span uk-icon="icon: refresh"></span>rotate</a>
            <input id="rotate-tree-slider" class="uk-range" type="range" min="0" max="360">
          </div>
        </li>
        <li>
          <div>
            <span uk-icon="icon: expand"></span>Font-Size</a>
            <input id="font-size-slider" class="uk-range" type="range" min="0.5" max="5" step="0.25">
          </div>
        </li>
        <li>
          <div>
            <span uk-icon="icon: expand"></span>Stroke-Width</a>
            <input id="stroke-width-slider" class="uk-range" type="range" min="0.5" max="5" step="0.25">
          </div>
        </li>
      </ul>
    </div>

    <div id="modal-sections" class="uk-flex-top" uk-modal>

      <div class="uk-modal-dialog">

        <button class="uk-modal-close-default" type="button" uk-close></button>

        <div class="uk-modal-header">
          <h2 class="uk-modal-title">Multiple Sequence alignment</h2>
        </div>

        <div class="uk-modal-body">
          <div id="msa-alignment-window" class="alignment"></div>
        </div>

        <div class="uk-modal-footer uk-text-left">
          <button class="uk-button uk-button-default uk-modal-close" type="button">Cancel</button>
          <button id="copy-multiple-sequence-alignment" class="uk-button uk-button-primary" type="button">Save</button>
        </div>


      </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>



    <!-- This is the beginning of the Color Section-->
    <div id="color-section"></div>
    <!-- This is the end of the Color Section-->

    <!-- This is the beginning of the Application Container-->
    <div>
      <canvas id="application-container" style="border:1px solid;"></canvas>
    </div>
    <!-- This is the end of the Application Container-->



    <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@v0.157.0/build/three.module.js",
          "three/addons/": "https://unpkg.com/three@v0.157.0/examples/jsm/"
        }
      }
    </script>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.6/dat.gui.min.js"></script>
    <script src="./winbox.min.js"></script>
    <link href="./winbox.min.css" rel="stylesheet">

    <script type="module">
      // Sample data: an array of points
      import Gui from "../static/js/gui.js";
      import constructTree from "../static/js/TreeConstructor.js";
      import TreeDisplay from "../static/js/TreeDisplay.js";
      import * as THREE from 'three';
      import { FlyControls } from 'three/addons/controls/FlyControls.js';
      import * as BufferGeometryUtils from 'three/addons/utils/BufferGeometryUtils.js';
      import WinBox from "https://unpkg.com/winbox@0.2.82/src/js/winbox.js";
      import { makeLinks, makeNodes } from "./treeIndex.js"
      import { makeInstanced } from "./dimensionalityReductionPlotter.js"
      import { createCamera, configureLightingAndReflections, createRenderer, configurePostProcessing } from "./treeIndex.js"
      import { highlightNodes, highlightLeaves, createAndAddTreeElementsToScene, initializeNodeSelectionAndHighlighting } from "./treeIndex.js"
      import { CosmosController, Universe, animateUniverse } from "./Cosmos.js"
      import { initializeDimensionalityReductionPlot } from "./dimensionalityReductionPlotter.js"
      import { initializeTreeDimensionPlot } from "./treeIndex.js"


      function assignUniqueIds(root) {
        let uidCounter = 0;

        function traverse(node) {
          // Assign a unique identifier to the current node
          node.uid = uidCounter++;

          // If the node has children, recursively assign UIDs to them
          if (node.children) {
            node.children.forEach(traverse);
          }
        }

        traverse(root);
      }


      d3.json("../static/test/random_generated_tree.json")
        .then((data) => {

          d3.json("../static/test/random_generated_tree_msa.json")
            .then((msa) => {

              let width = window.innerWidth;
              let height = window.innerHeight;

              let nodesMeshArray = [];
              let tree = constructTree(data, false, 'application-container');
              assignUniqueIds(tree);

              let links = tree.links();
              let nodes = tree.descendants();
              let leaves = tree.leaves();


              const colorScale = d3.scaleOrdinal()
                .domain(d3.range(data.groups[data.groups.length - 1] + 1))
                .range(d3.schemeCategory10);

              var cosmos = new CosmosController();

              //document.getElementById('data-value-plot-button').addEventListener("click", function (e) {
                initializeDimensionalityReductionPlot(cosmos, leaves, colorScale);
              // });

              initializeTreeDimensionPlot(cosmos, colorScale);
              createAndAddTreeElementsToScene(nodes, links, leaves, tree, cosmos.getUniverseById('tree-plot'), cosmos, colorScale);
              animateUniverse(cosmos.getUniverseById('tree-plot'));
              initializeNodeSelectionAndHighlighting(cosmos, colorScale);

              

            });



        });


    </script>


</body>

</html>