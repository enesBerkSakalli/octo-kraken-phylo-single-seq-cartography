<!DOCTYPE html>
<html>
<head>
    <style>
        .node {
            font: 10px sans-serif;
        }

        .link {
            fill: none;
            stroke: steelblue;
            stroke-opacity: 0.4;
        }
    </style>
</head>
<body>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script>

        var diameter = 960,
            radius = diameter / 2,
            innerRadius = radius - 120;

        var cluster = d3.cluster()
            .size([360, innerRadius]);

        var line = d3.radialLine()
            .curve(d3.curveBundle.beta(0.85))
            .radius(function(d) { return d.y; })
            .angle(function(d) { return d.x / 180 * Math.PI; });

        var svg = d3.select("body").append("svg")
            .attr("width", diameter)
            .attr("height", diameter)
            .append("g")
            .attr("transform", "translate(" + radius + "," + radius + ")");

        d3.json("../static/test/random_generated_tree.json", function(error, root) {
            if (error) throw error;

            var hierarchy = d3.hierarchy(root);
            cluster(hierarchy);

            var link = svg.append("g").selectAll(".link")
                .data(hierarchy.descendants().slice(1))
                .enter().append("path")
                .attr("class", "link")
                .attr("d", function(d) {
                    return "M" + project(d.x, d.y)
                        + "C" + project(d.x, (d.y + d.parent.y) / 2)
                        + " " + project(d.parent.x, (d.y + d.parent.y) / 2)
                        + " " + project(d.parent.x, d.parent.y);
                });

            var node = svg.append("g").selectAll(".node")
                .data(hierarchy.descendants())
                .enter().append("text")
                .attr("class", "node")
                .attr("dy", "0.31em")
                .attr("transform", function(d) { 
                    return "rotate(" + (d.x - 90) + ")translate(" + (d.y + 8) + ",0)" + 
                           (d.x < 180 ? "" : "rotate(180)"); 
                })
                .attr("text-anchor", function(d) { 
                    return d.x < 180 ? "start" : "end"; 
                })
                .text(function(d) { 
                    return d.data.name; 
                });

            function project(x, y) {
                var angle = (x - 90) / 180 * Math.PI, radius = y;
                return [radius * Math.cos(angle), radius * Math.sin(angle)];
            }
        });

    </script>
</body>
</html>
