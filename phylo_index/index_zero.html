<!DOCTYPE html>
<html lang="en">
<!-- Base HTML File written by Enes Berk Sakalli-->

<head>

    <head>
        <!-- Sets the character encoding for the document to UTF-8 -->
        <meta charset="utf-8" />

        <!-- The title of the document that appears in the title bar or tab of the browser -->
        <title>Phylo-Cello-Cartography</title>

        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="description" content="A brief description of your page." />
        <link rel="icon" href="favicon.ico" />

        <!-- Link to the external CSS file to style the document -->
        <link rel="stylesheet" href="../static/css/style.css" />

        <!-- Link to the D3.js library, which is a JavaScript library for creating dynamic and interactive data visualizations -->
        <script src="https://d3js.org/d3.v7.min.js"></script>

        <!-- Link to the UIkit CSS library for styling and layout -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.15.22/dist/css/uikit.min.css" />

        <!-- Link to the UIkit JavaScript library for interactive elements -->
        <script src="https://cdn.jsdelivr.net/npm/uikit@3.15.22/dist/js/uikit.min.js"></script>
        <!-- Link to the UIkit Icon library to enable use of various icons in the UI -->
        <script src="https://cdn.jsdelivr.net/npm/uikit@3.15.22/dist/js/uikit-icons.min.js"></script>

        <link href="https://unpkg.com/tabulator-tables@5.5.0/dist/css/tabulator.min.css" rel="stylesheet">
        <script type="text/javascript" src="https://unpkg.com/tabulator-tables@5.5.0/dist/js/tabulator.min.js"></script>

    </head>
</head>

<body>
    <div class="container">
        <!-- beginning of menu -->
        <div class="uk-card uk-card-default uk-card-body uk-width-1-6@s">
            <ul class="uk-nav-default" uk-nav>
                <li class="uk-nav-header">Phylo-Cello-Cartography</li>
                <li id="button-row"></li>
                <li>
                    <a href="./layouts/fcg.html"><span class="uk-margin-small-right"
                            uk-icon="icon: social"></span>Graph</a>
                </li>
                <li>
                    <a href="#" id="save-tree-button"><span class="uk-margin-small-right"
                            uk-icon="icon: camera"></span>Save</a>
                </li>
                <li>
                    <a href="#modal-dim-plot" uk-toggle><span class="uk-margin-small-right"
                            uk-icon="icon: camera"></span>Save</a>
                </li>
            </ul>

            <ul id="branch-values-vector" class="uk-nav uk-nav-sub">
                <li class="uk-nav-header"><span class="uk-margin-small-right" uk-icon="icon: nut"></span>
                    Branch Values
                </li>
            </ul>

            <ul id="select-mode-container" class="uk-nav uk-nav-sub">
                <li class="uk-nav-header"><span class="uk-margin-small-right" uk-icon="icon: file-text"></span>
                    MSA-Modus
                    <select id="mode-selector" class="uk-select" aria-label="Select">
                        <option value="phylo-msa">Model-Phylo-MSA</option>
                        <option value="classical-phylo">Mode-Classical-Phylo</option>
                    </select>
                </li>
            </ul>
            <ul id="select-color-mode-container" class="uk-nav uk-nav-sub">
                <li class="uk-nav-header"><span class="uk-margin-small-right" uk-icon="icon: file-text"></span>
                    Color-Mode
                    <select id="color-mode-selector" class="uk-select" aria-label="Select">
                        <option value="regular">Regular</option>
                        <option value="plasma">Plasma</option>
                    </select>
                </li>
            </ul>
            <ul class="uk-nav uk-nav-sub">
                <li>
                    <div>
                        <span uk-icon="icon: refresh"></span>rotate</a>
                        <input id="rotate-tree-slider" class="uk-range" type="range" min="0" max="360">
                    </div>
                </li>
                <li>
                    <div>
                        <span uk-icon="icon: expand"></span>Font-Size</a>
                        <input id="font-size-slider" class="uk-range" type="range" min="0.5" max="5" step="0.25">
                    </div>
                </li>
                <li>
                    <div>
                        <span uk-icon="icon: expand"></span>Stroke-Width</a>
                        <input id="stroke-width-slider" class="uk-range" type="range" min="0.5" max="5" step="0.25">
                    </div>
                </li>
            </ul>
        </div>

        <div id="modal-sections" class="uk-modal" uk-modal>

            <div class="uk-modal-dialog">

                <button class="uk-modal-close-default" type="button" uk-close></button>

                <div class="uk-modal-header">
                    <h2 class="uk-modal-title">Multiple Sequence alignment</h2>
                </div>

                <div class="uk-modal-body">
                    <div id="msa-alignment-window" class="alignment"></div>
                </div>

                <div class="uk-modal-footer uk-text-left">
                    <button class="uk-button uk-button-default uk-modal-close" type="button">Cancel</button>
                    <button id="copy-multiple-sequence-alignment" class="uk-button uk-button-primary"
                        type="button">Save</button>
                </div>


            </div>

        </div>


        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <div id="modal-dim-plot" class="uk-modal-full" uk-modal>
            <div class="uk-modal-dialog">
                <button class="uk-modal-close-full uk-close-large" type="button" uk-close></button>
                <canvas id="scatterChart" width="200" height="150"></canvas>
            </div>
        </div>

        <!-- This is the beginning of the Color Section-->
        <div id="color-section">

        </div>
        <!-- This is the end of the Color Section-->

        <!-- This is the beginning of the Application Container-->
        <div style="width: 95%; height: 95%">
            <svg id="application-container" width="100%" height="95%" xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink">>
                <g id="application"></g>
            </svg>
        </div>
        <!-- This is the end of the Application Container-->

        <script type="module">
            import Gui from "../static/js/gui.js";
            import constructTree from "../static/js/TreeConstructor.js";
            import TreeDisplay from "../static/js/TreeDisplay.js";
            import initializeLeafColorMap from "./optionHandler.js"
            import ModalColorArray from "./modalColorArray.js"



            //================================================= Properties =======================================================
            let gui = new Gui();
            let applicationContainer = document.getElementById("application-container");
            let width = applicationContainer.clientWidth;
            let height = applicationContainer.clientHeight;
            let leafColorMap = {};
            let groupColorMap = {};
            let treeDisplay;
            //================================================= Main =======================================================
            document.getElementById('font-size-slider').addEventListener('change', (e) => {
                treeDisplay.updateDisplay({
                    'fontSize': e.target.value,
                });
            });
            document.getElementById('stroke-width-slider').addEventListener('change', (e) => {
                treeDisplay.updateDisplay({
                    'strokeWidth': e.target.value,
                });
            });
            document.getElementById('stroke-width-slider').addEventListener('change', (e) => {
                treeDisplay.updateDisplay({
                    'strokeWidth': e.target.value,
                });
            });


            document.getElementById('mode-selector').addEventListener('change', (e) => {
                // Get the select element by its ID
                var selectElement = document.getElementById('mode-selector');
                // Get the selected value
                let selectedModel = selectElement.value;
                treeDisplay.updateDisplay({
                    'mode': selectedModel
                });
            });

            document.getElementById('mode-selector').addEventListener('change', (e) => {
                // Get the select element by its ID
                var selectElement = document.getElementById('color-mode-selector');
                // Get the selected value
                let selectedModel = selectElement.value;
                treeDisplay.updateDisplay({
                    'colorMode': selectedModel
                });
            });


            document.getElementById('rotate-tree-slider').addEventListener('input', (e) => {
                d3.select('#application').attr("transform", `translate(${width / 2}, ${height / 2})` + "rotate(" + e.target.value + ")");
            });


            d3.json("../static/test/random_generated_tree.json")
                .then((data) => {

                    d3.json("../static/test/random_generated_tree_msa.json")
                        .then((msa) => {

                            d3.select("#application").attr(
                                'transform', `translate(${width / 2}, ${height / 2})`
                            );


                            let median_depth = data.median_depth;
                            let average_depth = data.average_depth;

                            let tree = constructTree(data, false, 'application-container');
                            leafColorMap = initializeLeafColorMap(tree.leaves());                           
                            treeDisplay = new TreeDisplay(tree, tree.maxRadius, 'application');


                            treeDisplay.updateDisplay({
                                'leaveColorMap': leafColorMap,
                                'msaMatrix': msa,
                                'medianDepth': median_depth,
                                'averageDepth': average_depth,
                            });

                            ModalColorArray(tree);
                            // Instantiate the ColorSelector class and call the init method
                            setZoom();
                            handleDataOptionsList(tree, leafColorMap);

                            document.getElementById('save-tree-button').addEventListener('click', (e) => {
                                gui.saveSVG();
                            });

                        });
                });

            //================================================= Functions =======================================================

            // Plot as Cluster
            function plot_dimension_reduction_plot(tree) {
                // Select the SVG element where the scatter plot will be drawn
                let leaves = tree.leaves();
                const xValues = leaves.map(leaf => leaf.data.values.x);
                const yValues = leaves.map(leaf => leaf.data.values.y);

                const ctx = document.getElementById('scatterChart').getContext('2d');
                const scatterChart = new Chart(ctx, {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            label: 'Scatter Plot',
                            data: xValues.map((x, i) => ({ x, y: yValues[i] })),
                            backgroundColor: 'black'
                        }]
                    },
                    options: {
                        maintainAspectRatio: false,
                        width: 800, // Set the desired width
                        height: 600, // Set the desired height
                        scales: {
                            x: {
                                type: 'linear',
                                position: 'bottom'
                            },
                            y: {
                                type: 'linear',
                                position: 'left'
                            }
                        }
                    }
                });
            }
        </script>
</body>

</html>